---
id: syncer
title: Syncer
description: Polygon EdgeのSyncerモジュールについて説明します。
keywords:
  - docs
  - polygon
  - edge
  - architecture
  - module
  - synchronization
---

## 概要 {#overview}

このモジュールは同期プロトコルのためのロジックを含みます。これは、新しいノードを実行中のネットワークと同期、またはコンセンサス（ノンバリデータ）に参加しないノードのための新しいブロックの検証／挿入に使用されます。

Polygon Edgeはネットワーキングレイヤーとして**libp2p**を使用し、その上で**gRPC**を実行します。

Polygon Edgeには基本的に２つの同期タイプがあります：
* バルク同期 - 一時に大規模な範囲のブロックを同期
* ウォッチ同期 - ブロックごとに同期

### バルク同期 {#bulk-sync}

バルク同期の手順は比較的簡単で、他のピアから可能な（利用可能な）かぎり多くのブロックを同期し、できるだけ速く追い付くことを目的にするものです。

以下がバルク同期のプロセスの流れです：

1. **ノードがバルク同期を必要としているか判断する** - このステップでは、ノードがピアマップをチェックし、ローカルのノードが有するブロックよりも多くの数のブロックを誰かが持っているか確認します。
2. **最高のピアを探す（同期ピアマップを使用する）** -  このステップでは、ノードは上記の例で述べた条件に基づいて同期する最高のピアを見つけます。
3. **バルク同期ストリームを開く** - このステップでは、共通ブロック番号からブロックをバルク同期するために、ノードは最高のピアにgRPCストリームを開きます。
4. **バルク送信を行う時最高のピアはストリームを閉じる** - このステップでは、ノードが同期している最高のピアが持っているすべての利用可能なブロックを送信するとすぐにストリームを閉じます。
5. **バルク同期が完了した時、ノードがバリデータか確認する** - このステップでは、ストリームは最高のピアによって閉じられ、ノードはバルク同期後にバリデータであるか確認する必要があります。
  * もしバリデータならば、同期ステートから飛び出してコンセンサスへの参加をスタートします。
  * もしそうでなければ、引き続き **ウォッチ同期**します。

### ウォッチ同期 {#watch-sync}

:::info

ウォッチ同期の手順はノードがバリデータでなく、接近するブロックを聞くだけのネットワークの定期的なノンバリデータノードである場合のみに実行されます。
:::

ウォッチ同期の動作はかなり簡単で、ノードはすでにネットワークの残りの部分と同期されており、入ってくる新しいブロックだけを解析する必要があります。

以下がウォッチ同期のプロセスの流れです：

1. **ピアのステータスが更新される時に新しいブロックを追加する** - このステップでは、ノードが新しいブロックイベントについて聞き、新しいブロックがあるときにgRPC機能呼び出しを実行し、ブロックを取得し、ローカルステートを更新します。
2. **最新のブロックを同期した後にノードがバリデータであるかチェックする**
   * もしそうである場合、同期ステートから飛び出します。
   * そうでない場合、引き続き新しいブロックイベントについて聞きます。

## パフォーマンスレポート {#perfomance-report}

:::info

パフォーマンスはローカルマシン上で**百万ブロック**を同期することにより測定されました。
:::

| 名前 | 結果 |
|----------------------|----------------|
| 100万ブロックの同期 | 〜25分 |
| 100万ブロックの転送 | 〜1分 |
| GRPC呼び出し数 | 2 |
| テストカバレッジ | 〜93％ |