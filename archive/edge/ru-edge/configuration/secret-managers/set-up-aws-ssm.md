---
id: set-up-aws-ssm
title: Настройка AWS SSM (диспетчера систем)
description: "Настройка AWS SSM (диспетчера систем) для Polygon Edge."
keywords:
  - docs
  - polygon
  - edge
  - aws
  - ssm
  - secrets
  - manager
---

## Обзор {#overview}

В настоящее время Polygon Edge работает над тем, чтобы сохранять два основных секрета времени выполнения:
* **Приватный ключ валидатора**, который использует нод, при условии что нод является валидатором
* **Приватный ключ для сетевого взаимодействия**, который использует libp2p, для участия и общения с другими одноранговыми узлами

Подробнее см.  [Руководство по управлению приватными ключами](/docs/edge/configuration/manage-private-keys)

Модули Polygon Edge **не должны уметь хранить секреты**. В конечном итоге модуль не должен заботиться о том, хранится ли секрет на отдаленном сервере или локально на диске нода.

Все, что должен знать модуль о хранении секрета, — **это то, как использовать этот секрет**, **какие секреты получать или сохранять**. Более тонкие детали реализации этих операций делегируются `SecretsManager`, что, конечно же, является абстракцией.

Оператор нода, который запускает Polygon Edge, может теперь указывать, какой диспетчер секретов они хотят использовать, и, как только создается правильный диспетчер секретов, модули работают с секретами через указанный интерфейс, не заботясь о том, где хранятся секреты: на диске или на сервере.

В этой статье подробно описываются необходимые шаги для того, чтобы запустить Polygon Edge  вместе с [хранилищем параметров диспетчера систем AWS Systems Manager](https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html).

:::info предыдущие руководства
**Настоятельно рекомендуется** перед тем, как перейти к этой статье, ознакомиться со статьями о [**локальной настройке**](/docs/edge/get-started/set-up-ibft-locally) и [**облачной настройке**](/docs/edge/get-started/set-up-ibft-on-the-cloud).
:::


## Предварительные условия {#prerequisites}
### Политика IAM {#iam-policy}
Пользователю нужно создать политику IAM, позволяющую выполнять операции чтения-записи для хранилища параметров диспетчера систем AWS Systems Manager.
После успешного создания политики IAM пользователю необходимо прикрепить ее к экземпляру EC2, на котором работает сервер Polygon Edge.
Политика IAM должна выглядеть примерно так:
```json
{
  "Version": "2012-10-17",
  "Statement" : [
    {
      "Effect" : "Allow",
      "Action" : [
        "ssm:PutParameter",
        "ssm:DeleteParameter",
        "ssm:GetParameter"
      ],
      "Resource" : [
        "arn:aws:ssm:<aws_region>:<aws_account_id>:parameter<ssm-parameter-path>*"
      ]
    }
  ]
}
```
Подробнее о ролях AWS SSM IAM см. в [документации по AWS](https://docs.aws.amazon.com/systems-manager/latest/userguide/setup-instance-profile.html).

Прежде чем продолжить, ознакомьтесь со следующей информацией:
* **Region** (регион, в котором находятся диспетчер систем и ноды)
* **Parameter Path** (произвольный путь для сохранения секрета, например `/polygon-edge/nodes`)

## Шаг 1 — создание конфигурации диспетчера секретов {#step-1-generate-the-secrets-manager-configuration}

Чтобы Polygon Edge мог беспрепятственно взаимодействовать с AWS SSM, ему необходимо проанализировать уже созданный файл конфигурации, который содержит всю необходимую информацию для хранения секретов в AWS SSM.

Запустите следующую команду, чтобы создать конфигурацию:

```bash
polygon-edge secrets generate --type aws-ssm --dir <PATH> --name <NODE_NAME> --extra region=<REGION>,ssm-parameter-path=<SSM_PARAM_PATH>
```

Присутствующие параметры:
* `PATH`— это путь, по которому должен экспортироваться файл конфигурации. По умолчанию `./secretsManagerConfig.json`
* `NODE_NAME` — имя текущего нода, для которого настраивается конфигурация AWS SSM. Это может быть произвольное значение. По умолчанию `polygon-edge-node`
* `REGION` — регион, где находится AWS SSM. Это должен быть тот же регион, что и у нода, использующего AWS SSM.
* `SSM_PARAM_PATH` — имя пути, где будет храниться секрет. Например, если задать `--name node1` и `ssm-parameter-path=/polygon-edge/nodes`,
секрет будет храниться как `/polygon-edge/nodes/node1/<secret_name>`

:::caution Название нодов
Будьте внимательны, когда даете названия нодам.

Polygon Edge использует указанное название нода для отслеживания тех секретов, которые он генерирует и использует в AWS SSM. Если указать имя существующего нода, возможна ошибка записи секрета в AWS SSM.

Секреты хранятся на следующем базовом пути: `SSM_PARAM_PATH/NODE_NAME`
:::

## Шаг 2 — инициирование секретных ключей с помощью конфигурации {#step-2-initialize-secret-keys-using-the-configuration}

Теперь, когда файл конфигурации уже присутствует, мы можем инициализировать необходимые секретные ключи с помощью файла конфигурации, созданного в шаге 1, используя `--config`:

```bash
polygon-edge secrets init --config <PATH>
```

`PATH`Param — это местоположение ранее созданного диспетчера секретов param из шага 1.

:::info Политика IAM

На этом шаге произойдет ошибка, если политика IAM с разрешением операций чтения-записи настроена неправильно и/или не прикреплена к экземпляру EC2, который запускает эту команду.

:::

## Шаг 3 — создание генезис-файла {#step-3-generate-the-genesis-file}

Генезис-файл должен быть создан аналогично руководствам по [**локальной настройке**](/docs/edge/get-started/set-up-ibft-locally) и [**облачной настройке**](/docs/edge/get-started/set-up-ibft-on-the-cloud) с незначительными изменениями.

Поскольку AWS SSM используется вместо локальной файловой системы, адреса валидаторов должны быть добавлены через флаг `--ibft-validator`:
```bash
polygon-edge genesis --ibft-validator <VALIDATOR_ADDRESS> ...
```

## Шаг 4 — запуск клиента Polygon Edge {#step-4-start-the-polygon-edge-client}

Теперь, когда ключи созданы и генезис-файл генерируется, последний шаг для запуска всего процесса — это запуск Polygon Edge с помощью команды `server`.

Команда `server` используется так же, как и в вышеупомянутых руководствах, с незначительным дополнением — флаг `--secrets-config`:
```bash
polygon-edge server --secrets-config <PATH> ...
```

`PATH`Param — это местоположение ранее созданного диспетчера секретов param из шага 1.