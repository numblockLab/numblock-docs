---
id: set-up-hashicorp-vault
title: Настройка хранилища Hashicorp Vault
description: "Настройте хранилище Hashicorp Vaul для Polygon Edge."
keywords:
  - docs
  - polygon
  - edge
  - hashicorp
  - vault
  - secrets
  - manager
---

## Обзор {#overview}

В настоящее время Polygon Edge работает над тем, чтобы сохранять два основных секрета времени выполнения:
* **Приватный ключ валидатора**, который использует нод, при условии что нод является валидатором
* **Приватный ключ для сетевого взаимодействия**, который использует libp2p, для участия и общения с другими одноранговыми узлами

:::warning
Приватный ключ валидатора уникален для каждого узла валидатора. Один и тот же ключ <b>не</b> должен использоваться всеми валидаторами, поскольку это может поставить под угрозу безопасность вашей цепочки.
:::

Для получения более подробной информации просим вас ознакомиться с [Руководством по управлению приватными ключами](/docs/edge/configuration/manage-private-keys)

Модули Polygon Edge **не должны уметь хранить секреты**. В конечном итоге модуль не должен заботиться о том, хранится ли секрет на отдаленном сервере или локально на диске нода.

Все, что должен знать модуль о хранении секрета, — **это то, как использовать этот секрет**, **какие секреты получать или сохранять**. Более тонкие детали реализации этих операций делегируются `SecretsManager`, что, конечно же, является абстракцией.

Оператор нода, который запускает Polygon Edge, может теперь указывать, какой диспетчер секретов они хотят использовать, и, как только создается правильный диспетчер секретов, модули работают с секретами через указанный интерфейс, не заботясь о том, где хранятся секреты: на диске или на сервере.

В этой статье подробно описываются необходимые шаги для того, чтобы запустить Polygon Edge  вместе с сервером хранилища [Hashicorp Vault](https://www.vaultproject.io/).

:::info предыдущие руководства
**Настоятельно рекомендуется** перед тем, как перейти к этой статье, ознакомиться со статьями о [**локальной настройке**](/docs/edge/get-started/set-up-ibft-locally) и [**облачной настройке**](/docs/edge/get-started/set-up-ibft-on-the-cloud).
:::


## Предварительные условия {#prerequisites}

В этой статье предполагается, что функционирующий экземпляр сервера хранилища Hashicorp Vault **уже настроен**.

Кроме того, необходимо, чтобы на сервере хранилища Hashicorp Vault, который используется для Polygon Edge, было **включено хранилище KV**.

Прежде чем продолжить, ознакомьтесь со следующей информацией:
* **URL-адрес сервера** (URL API сервера хранилища Hashicorp Vault)
* **Токен** (токен доступа, используемый для доступа к двигателю хранилища KV)

## Шаг 1 — создание конфигурации диспетчера секретов {#step-1-generate-the-secrets-manager-configuration}

Чтобы Polygon Edge мог беспрепятственно взаимодействовать с сервером Vault, ему необходимо проанализировать уже созданный файл конфигурации, который содержит всю необходимую информацию для хранения секретов на Vault.

Запустите следующую команду, чтобы создать конфигурацию:

```bash
polygon-edge secrets generate --dir <PATH> --token <TOKEN> --server-url <SERVER_URL> --name <NODE_NAME>
```

Присутствующие параметры:
* `PATH`— это путь, по которому должен экспортироваться файл конфигурации. По умолчанию `./secretsManagerConfig.json`
* `TOKEN`— токен доступа, который ранее упоминается в [разделе о предварительных условиях](/docs/edge/configuration/secret-managers/set-up-hashicorp-vault#prerequisites)
* `SERVER_URL`— это URL API для сервера Vault, который также упоминается в [разделе о предварительных условиях](/docs/edge/configuration/secret-managers/set-up-hashicorp-vault#prerequisites)
* `NODE_NAME`— название текущего нода для которого создается конфигурация Vault. Это может быть произвольное значение. По умолчанию `polygon-edge-node`

:::caution Название нод
Будьте внимательны, когда даете названия нодам.

Polygon Edge использует указанное название нод для отслеживания тех секретов, которые он генерирует и использует на экземпляре Vault. Указание названия существующего нода может привести к перезаписи данных на сервере Vault.

Секреты хранятся на следующем базовом пути: `secrets/node_name`
:::

## Шаг 2 — инициирование секретных ключей с помощью конфигурации {#step-2-initialize-secret-keys-using-the-configuration}

Теперь, когда файл конфигурации уже присутствует, мы можем инициализировать необходимые секретные ключи с помощью файла конфигурации, созданного в шаге 1, используя `--config`:

```bash
polygon-edge secrets init --config <PATH>
```

`PATH`Param — это местоположение ранее созданного диспетчера секретов param из шага 1.

## Шаг 3 — создание генезис-файла {#step-3-generate-the-genesis-file}

Генезис-файл должен быть создан аналогично руководствам по [**локальной настройке**](/docs/edge/get-started/set-up-ibft-locally) и [**облачной настройке**](/docs/edge/get-started/set-up-ibft-on-the-cloud) с незначительными изменениями.

Поскольку Hashicorp Vault используется вместо локальной файловой системы, адреса валидаторов должны быть добавлены через флаг `--ibft-validator`:
```bash
polygon-edge genesis --ibft-validator <VALIDATOR_ADDRESS> ...
```

## Шаг 4 — запуск клиента Polygon Edge {#step-4-start-the-polygon-edge-client}

Теперь, когда ключи созданы и генезис-файл генерируется, последний шаг для запуска всего процесса — это запуск Polygon Edge с помощью команды `server`.

Команда `server` используется так же, как и в вышеупомянутых руководствах, с незначительным дополнением — флаг `--secrets-config`:
```bash
polygon-edge server --secrets-config <PATH> ...
```

`PATH`Param — это местоположение ранее созданного диспетчера секретов param из шага 1.