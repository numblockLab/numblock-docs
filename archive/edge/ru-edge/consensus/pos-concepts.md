---
id: pos-concepts
title: Доказательство доли владения (Proof of Stake)
description: "Разъяснения и инструкции относительно PoS (доказательства доли владения)."
keywords:
  - docs
  - polygon
  - edge
  - PoS
  - stake
---

## Обзор {#overview}

В этом разделе дается более детальный обзор некоторых концепций, присутствующих в реализации доказательства доли владения (PoS)
в Polygon Edge.

Реализация Polygon Edge PoS призвана служить альтернативой существующей реализации PoA IBFT,
чтобы дать операторам нодов возможность выбрать предпочтительный вариант при запуске цепочки.

## Характеристики PoS {#pos-features}

Логика ядра реализации PoS находится в
**[смарт-контракт стейкинга](https://github.com/0xPolygon/staking-contracts/blob/main/contracts/Staking.sol)**.

Этот контракт развертывается при инициализации механизма PoS цепочки Polygon Edge и доступен по адресу
`0x0000000000000000000000000000000000001001` из блока `0`.

### Эпохи {#epochs}

Эпохи — это концепция, введенная с добавлением PoS в Polygon Edge.

Эпохи — это специальные временные промежутки (в блоках), в которых определенный набор валидаторов может производить блоки.
Их длину можно изменять, т. е. операторы нодов могут настроить длину эпохи при генерировании генезиса.

В конце каждой эпохи создается _блок эпохи_, и после этого события начинается новая эпоха. Подробнее о блоках эпохи см. в разделе [Блоки эпохи](/docs/edge/consensus/pos-concepts#epoch-blocks).

Наборы валидаторов обновляются в конце каждой эпохи. Ноды запрашивают набор валидаторов из смарт-контракта стейкинга
при создании блока эпохи и сохраняют полученные данные в локальное хранилище. Этот цикл запроса и сохранения
повторяется в конце каждой эпохи.

Благодаря ему смарт-контракт стейкинга имеет полный контроль над адресами в наборе валидаторов, оставляя нодам только одну обязанность — один раз отправлять запрос к контракту во время эпохи для доставки информации о последнем
наборе валидаторов. Это избавляет отдельные ноды от необходимости обслуживать наборы валидаторов.

### Стейкинг {#staking}

Адреса могут вносить средства в качестве стейка для смарт-контракта стейкинга, вызывая метод `stake` и указывая значение
суммы стейка в транзакции:

````js
const StakingContractFactory = await ethers.getContractFactory("Staking");
let stakingContract = await StakingContractFactory.attach(STAKING_CONTRACT_ADDRESS)
as
Staking;
stakingContract = stakingContract.connect(account);

const tx = await stakingContract.stake({value: STAKE_AMOUNT})
````

Используя для стейкинга средства в смарт-контракте стейкинга, адреса помогут попадать в набор валидаторов и получать возможность участвовать в процессе создания блоков.

:::info Пороговое значение стейкинга

В настоящее время минимальное пороговое значение для входа в набор валидаторов предусматривает стейкинг `1 ETH`

:::

### Отзыв стейкинга {#unstaking}

Адреса, выделившие средства на стейкинг, могут **отозвать только все эти средства целиком**.

Отзыв стейкинга запускается посредством вызова метода `unstake` для смарт-контракта стейкинга:

````js
const StakingContractFactory = await ethers.getContractFactory("Staking");
let stakingContract = await StakingContractFactory.attach(STAKING_CONTRACT_ADDRESS)
as
Staking;
stakingContract = stakingContract.connect(account);

const tx = await stakingContract.unstake()
````

После отзыва средств для стейкинга адреса удаляются из набора валидаторов в смарт-контракте стейкинга и перестают считаться валидаторами в следующую эпоху.

## Блоки эпохи {#epoch-blocks}

**Блоки эпохи** — это понятие, введенное в реализации PoS IBFT в Polygon Edge.

Блоки эпохи — это специальные блоки, которые **не содержат транзакций** и появляются только **в конце эпохи**.
Например, если **размер эпохи** устанавливается в блоки, блоки эпохи будут считаться `50`блоками `50`, `100``150`и так далее.

Они используются для выполнения дополнительной логики, которая не должна использоваться при обычном создании блоков.

Более того, они показывают ноду, что ему **необходимо доставить информацию о последнем наборе валидаторов**
из смарт-контракта стейкинга.

После обновления набора валидаторов в блоке эпохи набор валидаторов (измененный или неизмененный)
используется для последующих `epochSize - 1` блоков, пока снова не обновляется посредством извлечения актуальной информации из
смарт-контракта стейкинга Staking Smart Contract.

Длина эпохи (в блоках) настраивается при генерировании файла генезиса с помощью специального параметра `--epoch-size`:

```bash
polygon-edge genesis --epoch-size 50 ...
```

По умолчанию размер эпохи в Polygon Edge составляет `100000` блоков.

## Предварительное развертывание контракта {#contract-pre-deployment}

Polygon Edge _предварительно развертывает_
[Смарт-контракт стейкинга](https://github.com/0xPolygon/staking-contracts/blob/main/contracts/Staking.sol)
во время **генерирования генезиса** на адрес `0x0000000000000000000000000000000000001001`.

Это делается без запуска EVM посредством изменения состояния блокчейна смарт-контракта напрямую с использованием
значений конфигурации, переданных команде генезиса.
