---
id: syncer
title: 동기화
description: Polygon 엣지의 동기화 모듈에 관한 설명.
keywords:
  - docs
  - polygon
  - edge
  - architecture
  - module
  - synchronization
---

## 개요 {#overview}

이 모듈에는 동기화 프로토콜에 대한 논리가 포함되어 있습니다. 새 노드를 실행 중인 네트워크와 동기화하거나 합의에 참여하지 않는 노드(비 검사기)를 위한 새 블록을 검증/삽입하는 데 사용됩니다.

Polygon 엣지는 **libp2p**를 네트워크 레이어로 사용하고 **gRPC**를 실행합니다.

Polygon 엣지에는 기본적으로 2가지의 동기화 유형이 있습니다.
* 대량 동기화(Bulk Sync) - 한 번에 넓은 범위의 블록을 동기화
* 감시 동기화(Watch Sync) - 블록 단위로 동기화

### 대량 동기화 {#bulk-sync}

대량 동기화의 목표는 다른 피어의 사용 가능한 블록을 최대한 빨리, 최대한 많이 동기화하는 것입니다. 이를 달성하기 위한 대량 동기화 단계는 상당히 단순합니다.

다음은 대량 동기화 프로세스의 흐름입니다.

1. ㅗ** 노드에 대량 동기화가 필요한지 결정 ** - 이 단계에서 노드는 피어 맵을 확인하여 해당 노드가 로컬에 가진 것보다 더 큰 블록 번호를 가진 노드가 있는지 판단합니다.
2. ** 최적의 피어 찾기(동기화 피어 맵 사용) ** - 이 단계에서 노드는 위 예에서 설명한 기준에 따라 동기화할 최적의 피어를 찾습니다.
3. ** 대량 동기화 스트림 열기 ** - 이 단계에서 노드는 공통 블록 번호의 블록과 대량 동기화를 진행하기 위해 gRPC 스트림을 최적의 피어로 엽니다.
4. ** 대량 전송이 완료되면 최적의 피어가 스트림을 닫음 ** - 이 단계에서 노드와 동기화 중인 최적의 피어는 사용 가능한 블록을 모두 전송하자마자 스트림을 닫습니다.
5. ** 대량 동기화가 완료되면 노드가 검사기인지 확인 ** - 이 단계에서 최적의 피어가 스트림을 닫고 대량 동기화가 완료되면, 노드가 검사기인지 확인해야 합니다.
  * 노드가 검사기면 동기화 상태에서 벗어나 합의에 참여하기 시작합니다.
  * 검사기가 아니면 **감시 동기화**를 진행합니다.

### 감시 동기화 {#watch-sync}

:::info

감시 동기화 단계는 노드가 검사기가 아닌, 블록을 수신 대기하는 네트워크의 일반적인 비 검사기 노드인 경우에만 실행됩니다.

:::

감시 동기화의 동작은 상당히 단순합니다. 노드는 이미 나머지 네트워크와 동기화되어 있으며, 새로 들어오는 블록만 파싱하면 됩니다.

다음은 감시 동기화 프로세스의 흐름입니다.

1. ** 피어의 상태가 업데이트될 때 새 블록 추가 ** - 이 단계에서 노드는 새 블록 이벤트를 수신 대기합니다. 새 블록이 발생하면 gRPC 함수 호출을 실행하여 블록을 가져오고 로컬 상태를 업데이트합니다.
2. ** 최신 블록을 동기화한 후 노드가 검사기인지 확인 **
   * 그렇다면, 동기화 상태 종료
   * 그렇지 않다면, 새 블록 이벤트에 대한 수신 대기 상태 지속

## 성능 보고 {#perfomance-report}

:::info

로컬 머신에서 **백만 개의 블록**을 동기화하여 성능을 측정했습니다.

:::

| 이름 | 결과 |
|----------------------|----------------|
| 1백만 개의 블록 동기화 | ~ 25분 |
| 1백만 개의 블록 전송 | ~ 1분 |
| GRPC 호출 수 | 2 |
| 테스트 범위 | ~ 93% |