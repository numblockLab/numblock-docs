---
id: pos-stake-unstake
title: ตั้งค่าและใช้ Proof of Stake (PoS)
description: "Stake, ยกเลิกการ Stake และคำแนะนำที่เกี่ยวกับการ Stake อื่นๆ"
keywords:
  - docs
  - polygon
  - edge
  - stake
  - unstake
  - validator
  - epoch
---

## ภาพรวม {#overview}

คู่มือนี้มีรายละเอียดเกี่ยวกับวิธีการตั้งค่าเครือข่าย Proof of Stake กับ Polygon Edge, วิธี Stake ทุนเพื่อให้โหนดกลายเป็นตัวตรวจสอบความถูกต้อง และวิธียกเลิกการ Stake ทุน

เป็นการ**สนับสนุนอย่างยิ่ง**ในการอ่านและผ่าน[การตั้งค่าภายใน](/docs/edge/get-started/set-up-ibft-locally)/ ส่วน [การตั้งค่าในระบบคลาวด์](/docs/edge/get-started/set-up-ibft-on-the-cloud) ก่อนไปต่อในคู่มือ PoS นี้ส่วนเหล่านี้สรุปขั้นตอนที่จำเป็นในการเริ่มต้นคลัสเตอร์ Proof of Authority (PoA) กับPolygon Edge

ในปัจจุบัน ไม่มีการจำกัดจำนวนตัวตรวจสอบความถูกต้องที่สามารถ Stake ทุนบนสัญญาอัจฉริยะการ Stake

## สัญญาอัจฉริยะการ Stake {#staking-smart-contract}

พื้นที่เก็บข้อมูลสำหรับสัญญาอัจฉริยะการ Stake อยู่[ที่นี่](https://github.com/0xPolygon/staking-contracts)

พื้นที่เก็บข้อมูลมีสคริปต์ทดสอบที่จำเป็น, ไฟล์ ABI และที่สำคัญที่สุดคือสัญญาอัจฉริยะการ Stake นั่นเอง

## การตั้งค่าคลัสเตอร์โหนด N {#setting-up-an-n-node-cluster}

เนื้อหาเกี่ยวกับการตั้งค่าเครือข่ายกับ Polygon Edge อยู่ในส่วน[การตั้งค่าภายใน](/docs/edge/get-started/set-up-ibft-locally)/ [การตั้งค่าในระบบคลาวด์](/docs/edge/get-started/set-up-ibft-on-the-cloud)

**ความแตกต่างเดียว**ระหว่างการตั้งค่าคลัสเตอร์ PoS และ PoA อยู่ในส่วนการสร้าง Genesis

**เมื่อสร้างไฟล์ Genesis สำหรับคลัสเตอร์ PoS จำเป็นต้องมีค่าสถานะเพิ่มเติม `--pos`** :

```bash
polygon-edge genesis --pos ...
```

## การตั้งค่าความยาวของ Epoch {#setting-the-length-of-an-epoch}

เนื้อหาเกี่ยวกับ Epoch อย่างละเอียดอยู่ในส่วน[บล็อก Epoch](/docs/edge/consensus/pos-concepts#epoch-blocks)

ในการกำหนดขนาดของ Epoch สำหรับคลัสเตอร์ (หน่วยเป็นบล็อก) เมื่อสร้างไฟล์ Genesis ค่าสถานะเพิ่มเติมจะได้รับการระบุ `--epoch-size`:

```bash
polygon-edge genesis --epoch-size 50
```

ค่านี้ระบุไว้ในไฟล์ Genesis ว่าขนาด Epoch ควรเป็น `50` บล็อก

ค่าเริ่มต้นสำหรับขนาดของ Epoch (หน่วยเป็นบล็อก) คือ `100000`

:::info การลดความยาว Epoch
ตามที่ระบุไว้ในส่วน[บล็อก Epoch](/docs/edge/consensus/pos-concepts#epoch-blocks)จะมีการใช้บล็อก Epoch เพื่ออัปเดตชุดตัวตรวจสอบความถูกต้องสำหรับโหนดต่างๆ

ความยาว Epoch เริ่มต้นที่มีหน่วยเป็นบล็อก (`100000`) อาจใช้เวลานานในการอัปเดตชุดตัวตรวจสอบความถูกต้องเมื่อพิจารณาว่าการเพิ่มบล็อกใหม่ใช้เวลาประมาณ 2 วินาที อาจใช้เวลาประมาณ 55.5 ชั่วโมงในการเปลี่ยนแปลงชุดตัวตรวจสอบความถูกต้องที่อาจเกิดขึ้น

การตั้งค่าที่ต่ำกว่าให้กับความยาว Epoch ช่วยให้มั่นใจได้ว่าชุดตัวตรวจสอบความถูกต้องได้รับการอัปเดตบ่อยขึ้น
:::

## การใช้สคริปต์สัญญาอัจฉริยะการ Stake {#using-the-staking-smart-contract-scripts}

### ข้อกำหนดเบื้องต้น {#prerequisites}

พื้นที่เก็บข้อมูลสัญญาอัจฉริยะการ Stake เป็นโปรเจ็กต์ Hardhat ที่ต้องมี NPM

ในการเริ่มต้นอย่างถูกต้อง ในไดเรกทอรีหลัก ให้เรียกใช้:

```bash
npm install
````

### การตั้งค่าสคริปต์ตัวช่วยที่ให้ไว้ {#setting-up-the-provided-helper-scripts}

สคริปต์สำหรับโต้ตอบกับสัญญาอัจฉริยะการ Stake ที่ปรับใช้มีอยู่ใน[พื้นที่เก็บข้อมูลสัญญาอัจฉริยะการ Stake](https://github.com/0xPolygon/staking-contracts)

สร้างไฟล์  `.env` ด้วยพารามิเตอร์ต่อไปนี้ในตำแหน่งพื้นที่เก็บข้อมูลสัญญาอัจฉริยะ:

```bash
JSONRPC_URL=http://localhost:10002
PRIVATE_KEYS=0x0454f3ec51e7d6971fc345998bb2ba483a8d9d30d46ad890434e6f88ecb97544
STAKING_CONTRACT_ADDRESS=0x0000000000000000000000000000000000001001
BLS_PUBLIC_KEY=0xa..
```

โดยที่พารามิเตอร์ต่างๆ คือ:

* **JSONRPC_URL** - JSON-RPC Endpoint สำหรับโหนดที่เรียกใช้
* **PRIVATE_KEYS** - คีย์ส่วนตัวของที่อยู่ของผู้วาง Stake
* **STAKING_CONTRACT_ADDRESS** - ที่อยู่ของสัญญาอัจฉริยะการ Stake (
ค่าเริ่มต้น `0x0000000000000000000000000000000000001001`)
* **BLS_PUBLIC_KEY** - คีย์สาธารณะ BLS ของผู้วาง Stakeจำเป็นเฉพาะเมื่อเครือข่ายทำงานกับ BLS

### ทุนการ Stake {#staking-funds}

:::info ที่อยู่การ Stake
ปรับใช้สัญญาอัจฉริยะการ Stake ล่วงหน้าที่ที่อยู่ `0x0000000000000000000000000000000000001001`

การโต้ตอบประเภทใดก็ตามกับกลไกการ Stake จะทำผ่านสัญญาอัจฉริยะการ Stake ตามที่อยู่ที่ระบุ

ดูเพิ่มเติมเกี่ยวกับสัญญาอัจฉริยะการ Stake ได้ที่**[สัญญาแบบ Stake](/docs/edge/consensus/pos-concepts#contract-pre-deployment)**
:::

เพื่อเป็นส่วนหนึ่งของชุดตัวตรวจสอบความถูกต้อง ที่อยู่ต้อง Stake ยอดทุนที่มากกว่าเกณฑ์ที่กำหนด

ตอนนี้ เกณฑ์เริ่มต้นสำหรับการเป็นส่วนหนึ่งของชุดตัวตรวจสอบความถูกต้องคือ `1 ETH`

เริ่มต้นการ Stake ได้โดยเรียกเมธอด `stake` ของสัญญาอัจฉริยะการ Stake และระบุค่า `>= 1 ETH`

หลังจากไฟล์ `.env` ที่กล่าวถึงใน[ส่วนก่อนหน้า](/docs/edge/consensus/pos-stake-unstake#setting-up-the-provided-helper-scripts) ได้รับการตั้งค่า และเริ่มต้นเชนในโหมด PoS แล้ว จะสามารถทำการ Stake ได้ด้วยคำสั่งต่อไปนี้ในพื้นที่เก็บข้อมูลสัญญาอัจฉริยะการ Stake:

```bash
npm run stake
```

`stake`สคริปต์ Hardhat ทำการ Stake จำนวนเงินเริ่มต้นของ `1 ETH` ซึ่งสามารถเปลี่ยนแปลงได้โดยการแก้ไขไฟล์ `scripts/stake.ts`

หากทุนที่ Stake อยู่ `>= 1 ETH` จะมีการอัปเดตชุดตัวตรวจสอบความถูกต้องในสัญญาอัจฉริยะการ Stake และที่อยู่จะเป็นส่วนหนึ่งของชุดตัวตรวจสอบความถูกต้องตั้งแต่ Epoch ถัดไป

:::info การลงทะเบียนคีย์ BLS
หากเครือข่ายทำงานในโหมด BLS เพื่อให้โหนดกลายเป็นตัวตรวจสอบความถูกต้อง จะต้องลงทะเบียนคีย์สาธารณะ BLS หลังการ Stake

ซึ่งสามารถทำได้ด้วยคำสั่งต่อไปนี้:

```bash
npm run register-blskey
```
:::

### การยกเลิกการ Stake ทุน {#unstaking-funds}

ที่อยู่ที่มี Stake สามารถ**ยกเลิกการ Stake ทุนทั้งหมดของที่อยู่**ได้ครั้งเดียว

หลังจากไฟล์ `.env` ที่กล่าวถึงใน[ส่วนก่อนหน้านี้](/docs/edge/consensus/pos-stake-unstake#setting-up-the-provided-helper-scripts)ได้รับการตั้งค่าและเริ่มต้นเชนในโหมด PoS แล้ว จะสามารถทำการยกเลิกการ Stake ได้ด้วยคำสั่งต่อไปนี้ในพื้นที่เก็บข้อมูลสัญญาอัจฉริยะการ Stake:

```bash
npm run unstake
```

### การดึงรายการผู้วาง Stake {#fetching-the-list-of-stakers}

ที่อยู่ทั้งหมดที่ Stake ทุนจะได้รับการบันทึกไว้ในสัญญาอัจฉริยะการ Stake

หลังจากไฟล์ `.env` ที่กล่าวถึงใน[ส่วนก่อนหน้านี้](/docs/edge/consensus/pos-stake-unstake#setting-up-the-provided-helper-scripts)ได้รับการตั้งค่าและเริ่มต้นเชนในโหมด PoS แล้ว จะสามารถทำการดึงรายการตัวตรวจสอบความถูกต้องได้ด้วยคำสั่งต่อไปนี้ในพื้นที่เก็บข้อมูลสัญญาอัจฉริยะการ Stake:

```bash
npm run info
```
