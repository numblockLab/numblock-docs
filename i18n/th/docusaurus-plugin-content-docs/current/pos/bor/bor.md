---
id: bor
title: สถาปัตยกรรม Bor
description: บทบาทของ Bor ในสถาปัตยกรรม Polygon
keywords:
  - docs
  - matic
  - Bor Architecture
  - polygon
image: https://matic.network/banners/matic-network-16x9.png
---
import useBaseUrl from '@docusaurus/useBaseUrl';

# สถาปัตยกรรม Bor {#bor-architecture}

Polygon คือแพลตฟอร์ม **Plasma + Proof-of-Sake (PoS)**เราใช้สถาปัตยกรรมประเภทฉันทามติสองชั้นในเครือข่าย Polygon เพื่อเพิ่มประสิทธิภาพในส่วนความเร็วและการทำงานแบบไมมีตัวกลางเราตั้งใจออกแบบระบบเชิงสถาปัตยกรรมให้รองรับการเปลี่ยนสถานะตามต้องการบนไซด์เชนของเรา ซึ่งสามารถใช้ EVM ได้

## สถาปัตยกรรม {#architecture}

<img src={useBaseUrl("img/Bor/matic_structure.png")}/>

บล็อกเชนเป็นชุดไคลเอ็นต์ในเครือข่ายที่โต้ตอบและดำเนินการร่วมกันไคลเอ็นต์เป็นส่วนของซอฟต์แวร์ที่สามารถสร้างช่องทางสื่อสารแบบ p2p กับไคลเอ็นต์อื่นๆ ลงนามและเผยแพร่ธุรกรรม ปรับใช้และโต้ตอบกับสัญญาอัจฉริยะ ฯลฯ เรามักพูดถึงไคลเอ็นต์ในฐานะโหนด

สำหรับ Polygon โหนด ถูกออกแบบโดยมี Heimdall การดำเนินการสองชั้น (เลย์ตัวตรวจสอบความถูกต้อง) และ Bor(บล็อกผู้สร้าง)

1. Heimdall
    - การตรวจสอบความถูกต้องแบบ Proof-of-Stake
    - การสร้างเช็คพอยต์บล็อกในเชนหลักของ Ethereum
    - การจัดการผลตอบแทนและตัวตรวจสอบความถูกต้อง
    - การรับรองการซิงค์กับเชนหลักของ Ethereum
    - บริดจ์แบบไม่มีตัวกลาง
2. Bor
    - เชน Polygon
    - VM ที่เข้ากันได้กับ EVM
    - การเลือกชุดผู้สร้างบล็อกและผู้เสนอ
    - การเรียกใช้ระบบ
    - รูปแบบค่าธรรมเนียม

## Heimdall (เลเยอร์ตัวตรวจสอบความถูกต้อง) {#heimdall-validator-layer}

Heimdall (All-Protector) คือตัวแกะรอย ของทั้งหมดที่เกิดขึ้นใน Polygon Proof of Sake – ดีหรือเลว

Heimdall เป็นเลเยอร์ตัวตรวจสอบแบบ Proof-of-Stake ของเรา ซึ่งรับผิดชอบในการสร้างเช็คพอยต์ให้กับตัวแทนของบล็อก Plasma ไปยังเชนหลักในสถาปัตยกรรมของเราเราได้นำสิ่งนี้ไปปรับใช้โดยสร้างไว้เพื่อสนับสนุนกลไกจัดการฉันทามติของ Tendermint โดยมีการเปลี่ยนแปลงรูปแบบลายเซ็นและโครงสร้างข้อมูลต่างๆ

โปรดอ่านข้อมูลเพิ่มเติมที่ [https://blog.matic.network/heimdall-and-bor-matic-validator-and-block-production-layers/](https://blog.matic.network/heimdall-and-bor-matic-validator-and-block-production-layers/)

## Bor (เลเยอร์ผู้สร้างบล็อก) {#bor-block-producer-layer}

โดยพื้นฐานแล้ว การนำโหนด Bor ไปใช้ถือเป็นตัวดำเนินการของไซด์เชนSidechain VM เข้ากันได้กับ EVMในปัจจุบัน นี่เป็นการนำ Geth พื้นฐานไปใช้งานโดยมีการเปลี่ยนแปลงแบบกำหนดเองที่ทำกับอัลกอริทึมฉันทามติอย่างไรก็ตาม สิ่งนี้จะได้รับการสร้างขึ้นใหม่ตั้งแต่ต้นเพื่อช่วยให้ใช้ทรัพยากรน้อยและเน้นการใช้งานเฉพาะ

Bor เป็นเลเยอร์ผู้สร้างบล็อกของเรา เลือกผู้สร้างบล็อก และตรวจสอบความถูกต้องของแต่ละสแปนและสปรินต์แต่ละรายการ ซึ่งซิงค์กับ Heimdallการโต้ตอบสำหรับผู้ใช้ Polygon ดำเนินการอยู่ในไซด์เชนนี้ ซึ่งสามารถเข้ากันได้กับ EVM เพื่อใช้ประโยชน์จากประสิทธิภาพในการใช้งานและความสามารถในการเข้ากันกับเครื่องมือและแอปพลิเคชันสำหรับนักพัฒนา Ethereum

### เชน Polygon {#polygon-chain}

เชนนี้เป็นบล็อกเชนแยกต่างหากที่ติดกับ Ethereum โดยใช้ PEG แบบสองทางPEG แบบสองทางทำให้เราสามารถเปลี่ยนแปลงสินทรัพย์ระหว่าง Ethereum กับ Polygon ได้

### VM ที่เข้ากันได้กับ EVM {#evm-compatible-vm}

Ethereum Virtual Machine (EVM) เป็น Virtual Stack แบบ Sandbox อันทรงพลังที่ประกอบอยู่ในโหนดเต็มของ Polygon แต่ละโหนด และรับผิดชอบการดำเนินการกับไบต์โค้ดของสัญญาโดยทั่วไป สัญญาต่างๆ จะได้รับการเขียนโดยใช้ภาษาระดับสูง เช่น Solidity แล้วคอมไพล์ลงในไบต์โค้ด EVM

### การคัดเลือกผู้เสนอและผู้สร้างบล็อก {#proposers-and-producers-selection}

ผู้สร้างบล็อกสำหรับเลเยอร์ Bor เป็นกรรมการที่เลือกจากพูลตัวตรวจสอบความถูกต้อง โดยพิจารณาจาก Stake ของพวกเขา ซึ่งจะมีการดำเนินเป็นระยะๆ อย่างสม่ำเสมอ และมีการสับเปลี่ยนเป็นครั้งคราวโดยช่วงเวลาเหล่านี้จะได้รับการกำหนดโดยการควบคุมของตัวตรวจสอบความถูกต้อง โดยพิจารณาตาม Dynasty และเครือข่าย

อัตราส่วนของ Stake/อิทธิพลจากการ Stake จะระบุความเป็นไปได้ในการรับการเลือกเป็นสมาชิกของกรรมการผู้สร้างบล็อก

<img src={useBaseUrl("img/Bor/bor-span.png")} />

#### กระบวนการเลือก {#selection-process}

- สมมติว่าเรามีตัวตรวจสอบความถูกต้องในพูล 3 ราย ได้แก่ Alice, Bill และ Clara
- Alice ได้ Stake โทเค็น MATIC จำนวน 100 โทเค็น ส่วน Bill และ Clara ได้ Stake โทเค็น MATIC จำนวน 40 โทเค็น
- ตัวตรวจสอบความถูกต้องได้รับสล็อตตาม Stake เนื่องจาก Alice ได้ Stake โทเค็น MATIC จำนวน 100 โทเค็น เธอจะได้สล็อตตามอัตราส่วนโดย Alice จะได้รับทั้งหมด 5 สล็อตในทำนองเดียวกัน Bill และ Clara จะได้รับทั้งหมด 2 สล็อต
- ตัวตรวจสอบความถูกต้องทั้งหมดได้รับสล็อตดังต่อไปนี้ [A, A, A, A, A, B, B, C, C]
- เราจะสลับอาร์เรย์นี้ โดยใช้ข้อมูลบล็อกของ Ethereum ในอดีตเป็น Seed
- หลังจากมีการสลับสล็อตโดยใช้ Seed แล้ว สมมติว่าเราได้อาร์เรย์ดังนี้ [A, B, A, A, C, B, A, A, C]
- ตอนนี้ เราจะเลือกตัวตรวจสอบความถูกต้องจากลำดับแรกสุดตามจำนวนผู้สร้างบล็อก*(ที่ดูแลโดยการควบคุมของตัวตรวจสอบความถูกต้อง)*เช่น หากต้องการเลือกผู้สร้างบล็อก 5 ราย เราจะได้ชุดผู้สร้างบล็อกเป็น [A, B, A, A, C]
- ดังนั้น จะมีการกำหนดชุดผู้สร้างบล็อกสำหรับสแปนถัดไปเป็น [A:3, B:1, C:1]
- เราเลือกผู้สร้างบล็อกสำหรับทุกสปรินต์ใน BOR โดยใช้ชุดตัวตรวจสอบความถูกต้องนี้และอัลกอริทึมการเลือกผู้เสนอของ tendermint

### อินเทอร์เฟซ SystemCall {#systemcall-interface}

การเรียกระบบเป็นที่อยู่ของตัวดำเนินการภายในซึ่งอยู่ภายใต้ EVMสิ่งนี้ช่วยรักษาสถานะให้กับผู้สร้างบล็อกสำหรับสปรินต์ทั้งหมดทริกเกอร์การเรียกระบบไปที่ตอนท้ายของสปรินต์ และสร้างคำขอรายการผู้สร้างบล็อกใหม่เมื่อมีการอัปเดตสถานะแล้ว จะได้รับข้อมูลการเปลี่ยนแปลงต่างๆ หลังจากการสร้างบล็อกใน Bor มาที่ตัวตรวจสอบความถูกต้องทั้งหมด

### ฟังก์ชัน {#functions}

#### ขอแต่งงาน {#proposestate}

- อนุญาตให้เรียกใช้กับตัวตรวจสอบความถูกต้องเท่านั้น
- ตรวจสอบ `stateId` หากมีการเสนอหรือคอมมิตแล้ว
- เสนอ `stateId` และอัปเดตค่าสถานะเป็น `true`

#### ImaState {#commitstate}

- อนุญาตให้เรียกใช้กับระบบเท่านั้น
- ตรวจสอบ `stateId` หากมีการเสนอหรือคอมมิตแล้ว
- แจ้งสัญญา `StateReceiver` เกี่ยวกับ `stateId` ใหม่
- อัปเดตค่าสถานะ `state` เป็น `true` และ `remove` เป็น `proposedState`

#### ขอโพสสแปนัน {#proposespan}

- อนุญาตให้เรียกใช้กับตัวตรวจสอบความถูกต้องเท่านั้น
- ตรวจสอบว่าข้อเสนอของสแปนเป็น `pending` หรือไม่
- อัปเดตข้อเสนอของสแปนเป็น `true`

#### ขอแต่งงาน {#proposecommit}

- อนุญาตให้เรียกใช้กับระบบเท่านั้น
- กำหนด `initial validators` หากสแปนปัจจุบันเป็นศูนย์
- ตรวจสอบเงื่อนไขสำหรับ `spanId` และ `time_period` สำหรับสปรินต์และสแปน
- อัปเดต `span` และ `time_period` ใหม่
- กำหนด `validators` และ `blockProducers` ให้กับ `sprint`
- อัปเดตค่าสถานะสำหรับ `spanProposal` เป็น `true`

### รูปแบบค่าธรรมเนียม Bor {#bor-fee-model}

สำหรับธุรกรรมปกติ มีการเรียกเก็บค่าธรรมเนียมเป็นโทเค็น MATIC และแบ่งให้กับผู้สร้างบล็อก ซึ่งคล้ายกับธุรกรรมของ Ethereum

Polygon มีโทเค็นของตนเอง เช่นเดียวกับบล็อกเชนอื่นๆ ซึ่งเรียกว่า Matic(MATIC)MATIC เป็นโทเค็น ERC20 ที่ใช้สำหรับจ่ายค่าแก๊ส (ค่าธรรมเนียมธุรกรรม) ใน Polygon และสำหรับการ Stake

:::info

สิ่งสำคัญที่คุณต้องจำไว้ คือ ในเชน Polygon มีการใช้โทเค็น MATIC เป็นโทเค็น ERC20 ซึ่งเป็นโทเค็นดั้งเดิมด้วย จึงมีการใช้โทเค็นสองประเภทในเวลาเดียวกันดังนั้น หมายความว่า ผู้ใช้สามารถชำระค่าแก๊สโดย MATIC และส่ง MATIC ไปยังบัญชีอื่นได้ด้วย

:::

สำหรับสัญญา Genesis `gasPrice`และ`gasLimit`ใช้งานได้เหมือนกับ Ethereum แต่ระหว่างการดำเนินการจะไม่หักค่าธรรมเนียมจากบัญชีของผู้ส่งอีก

ธุรกรรม Genesis จากตัวตรวจสอบความถูกต้องปัจจุบันจะได้รับการดำเนินการด้วย `gasPrice = 0`

นอกจากนี้ ตัวตรวจสอบความถูกต้องต้องส่งธุรกรรมประเภทต่อไปนี้ เช่น ข้อเสนอของสถานะเช่น การฝากและข้อเสนอของ Span บน Bor

## ข้อมูลเชิงลึกทางเทคนิค {#technical-insight}

### สัญญา Genesis {#genesis-contracts}

[BorValidatorSet(0x1000)](https://github.com/maticnetwork/genesis-contracts/blob/master/contracts/BorValidatorSet.template) ⇒ สัญญานี้จัดการชุดตัวตรวจสอบความถูกต้องสำหรับแต่ละสแปนและสปรินต์

[BorStateReceiver(0x1001)](https://github.com/maticnetwork/genesis-contracts/blob/master/contracts/StateReceiver.sol) ⇒ สัญญานี้จัดการกับการโอนข้อมูลของสัญญาแบบกำหนดเองจากสัญญา Ethereum ไปยังสัญญา Polygon

MaticChildERC20(0x1010) ⇒ สัญญาย่อยสำหรับโทเค็นเชนหลักซึ่งทำให้สามารถย้ายสินทรัพย์จาก Ethereum ไปยัง Polygon

### [Bor.go](https://github.com/maticnetwork/bor/blob/master/consensus/bor/bor.go)

โปรโตคอล Bor

## อภิธานศัพท์ {#glossary}

- StartEpoch - โพสต์ของหมายเลขเช็คพอยต์ที่ตัวตรวจสอบความถูกต้องได้รับการเปิดใช้งานและจะเข้าร่วมในฉันทามติ
- EndEpoch - โพสต์ของหมายเลขเช็คพอยต์ที่ตัวตรวจสอบความถูกต้องได้รับการพิจารณาว่าไม่ใช้งานแล้วและไม่เข้าร่วมในฉันทามติ
- Sprint - สปรินต์เป็นชุดต่อเนื่องของบล็อกที่ตัวตรวจสอบความถูกต้องหนึ่งสร้างขึ้น
- Span -  สแปนเป็นชุดใหญ่ของบล็อกที่มีชุดตัวตรวจสอบความถูกต้องที่กำหนดไว้แน่นอน แต่ประกอบด้วยสปรินต์จำนวนมากเช่น สำหรับสแปนซึ่งมีความยาว 6400 บล็อก สแปนนั้นจะประกอบด้วยบล็อกของสปรินต์ 100 รายการจำนวน 64 บล็อก
- Dynasty: เวลาระหว่างการสิ้นสุดลงของการประมวลล่าสุดและเวลาเริ่มการประมวลใหม่

## แหล่งข้อมูล {#resources}

- [Bor](https://github.com/maticnetwork/bor)
- [EVM](https://www.bitrates.com/guides/ethereum/what-is-the-unstoppable-world-computer)
- [อีเอ็มทำงานยังไง](https://medium.com/mycrypto/the-ethereum-virtual-machine-how-does-it-work-9abac2b7c9e)
- [การเลือกโพรพอสเม้นท์](https://docs.tendermint.com/master/spec/reactors/consensus/proposer-selection.html)
