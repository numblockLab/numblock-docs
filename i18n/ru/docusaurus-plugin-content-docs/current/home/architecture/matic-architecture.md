---
id: polygon-architecture
title: Архитектура Polygon PoS
description: Архитектура Polygon PoS, включая цепочки Heimdall и Bor
keywords:
  - docs
  - matic
  - polygon
  - architecture
  - pos
  - blockchain
image: https://wiki.polygon.technology/img/polygon-wiki.png
---
import useBaseUrl from '@docusaurus/useBaseUrl';

# Архитектура Polygon PoS {#polygon-pos-architecture}

Сеть Polygon — это блокчейн-платформа, которая обеспечивает работу гибридных сайдчейнов с использованием механизмов Proof-of-Stake и Plasma.

Архитектурно красота Polygon — это его элегантный дизайн, который имеет общий слой валидации, отделенный от различных окружений исполнения, таких как full-blown сайдчейны EVM и другие подходы уровня 2, такие как роллеты с нулевым знанием.

Для поддержки работы механизма PoS на нашей платформе мы используем набор контрактов по управлению **стейкингом** на Ethereum, а также набор стимулируемых валидаторов, поддерживающих ноды **Heimdall** и **Bor**. Ethereum — первая базовая цепочка, которую поддерживает Polygon. Однако в дальнейшем сеть планирует интегрировать поддержку дополнительных цепей, основываясь на предложениях сообщества и консенсусе. Это обеспечит интероперабильную децентрализованную блокчейн-платформу уровня 2.

Polygon PoS представляет собой трехуровневую архитектуру:

1. Смарт-контракты для стейкинга на Ethereum
2. Heimdall (уровень Proof of Stake)
3. Bor (уровень блок продюсера)

<img src={useBaseUrl("img/matic/Architecture.png")} />

### Смарт-контракты Polygon (на Ethereum) {#polygon-smart-contracts-on-ethereum}

Polygon поддерживает набор смарт-контрактов на Ethereum, которые обеспечивают следующее:

- Управление стейкингом для уровня Proof-of-Stake
- Управление делегированием, включая доли валидаторов
- Checkpoint/снимки состояния сайдчейна

### Heimdall (уровень валидаторов Proof-of-Stake) {#heimdall-proof-of-stake-validator-layer}

**Heimdall** — это узел проверки PoS, который работает совместно с контрактами стейкинга на Ethereum, чтобы обеспечить работу механизма PoS в Polygon. Мы реализовали это решение путем надстройки в механизме консенсуса Tendermint с внесением изменений в схему подписи и различные структуры данных. Оно отвечает за подтверждение блоков, отбор комитета блок продюсеров, чекпойнтинг представленности блоков сайдчейна на Ethereum в нашей архитектуре и другие задачи.

Уровень Heimdall позволяет объединять блоки, созданные Bor, в дерево Меркла и периодически публиковать корень Меркла в основной цепочке. Эти периодические публикации называются `checkpoints`. Валидатор в каждых нескольких блоках Bor (на уровне Heimdall) выполняет следующие действия:

1. Подтверждает все блоки с момента последней созданного checkpoint
2. Создает древо Меркла из хэшей блока
3. Публикует корень Меркла в mainchain

Точки checkpoint важны по двум причинам:

1. Обеспечение финализации в основной цепочке
2. Предоставление подтверждения сжигания при выводе активов

В целом процесс можно объяснить следующим образом:

- Из пула выбирается подмножество активных валидаторов на роль блок-продюсеров для определенного промежутка блоков. Отбор для каждого промежутка также опирается на одобрение не менее 2/3 голосующих. Эти производители блоков отвечают за создание блоков и его трансляцию в оставшуюся сеть.
- Checkpoint включает корень всех блоков, созданных в течение любых заданных интервалов. Все ноды подтверждают то же самое и прикрепляют свою подпись.
- Выбранный proposer из набора валидатора отвечает за сбор всех подписей для конкретного checkpoint и выполнение того же в основной цепочке.
- Ответственность за создание блоков, а также предложенные контрольные точки имеют вариативную зависимость от соотношения стейка валидатора к общему пулу.

### Bor (уровень блок продюсеров) {#bor-block-producer-layer}

Bor — это уровень блок продюсеров Polygon — реализация, которая отвечает за объединение транзакций в блоки.

Блок продюсеры периодически перетасовываются с помощью отбора комитета на Heimdall в рамках сроков, определенных как `span` в Polygon. Блоки производятся в ноде **Bor**, и VM сайдчейна совестима с EVM. Блоки, произведенные в Bor, также периодически подтверждаются нодами Heimdall, и checkpoint, который представляет собой хэш древа Меркла с набором блоков, созданных в Bor, периодически публикуется в Ethereum.

### Информационные ресурсы {#resources}

- [Архитектура Bor](https://forum.polygon.technology/t/matic-system-overview-bor/9123)
- [Архитектура Heimdall](https://forum.polygon.technology/t/matic-system-overview-heimdall/8323)
- [Механизм checkpoint](https://forum.polygon.technology/t/checkpoint-mechanism-on-heimdall/7160)
